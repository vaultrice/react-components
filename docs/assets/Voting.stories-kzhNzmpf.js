import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as f}from"./iframe-CUKlEioi.js";import{e as V}from"./theme-ELSemj-T.js";import"./preload-helper-D9Z9MdNV.js";function C(i,t,n){const[l,d]=f.useState(),[g,p]=f.useState(),[v,o]=f.useState(!0),c=V({...n?.instanceOptions,id:i},n?.credentials),u=n?.bind??!0;if(f.useEffect(()=>{if(!c)return;o(!0);try{(async function(a,s,m){let h;typeof s=="string"?(h=await a.getItem(s),m&&m({[`${s}`]:h})):(h=await a.getItems(s),m&&m(h))})(c,t,a=>{d(a),o(!1)})}catch(a){p(a),o(!1)}const r={};return u&&(Array.isArray(t)?t:[t]).forEach(a=>{const s=(m=>function(h){d(w=>({...w,[`${m}`]:h}))})(a);r[a]=s,c.on("setItem",a,s)}),()=>{u&&Object.keys(r).forEach(a=>{c.off("setItem",a,r[a])})}},[t]),typeof t=="string"){const r=async()=>{o(!0);try{const s=await c.getItem(t);return o(!1),s}catch(s){p(s),o(!1)}},a=s=>{s&&d(m=>({...m,[`${t}`]:s}))};return[c,l?l[t]:void 0,a,r,g,p,v]}return[c,l,d,async()=>{o(!0);try{const r=await c.getItems(t);return o(!1),r}catch(r){p(r),o(!1)}},g,p,v]}const _=(i,t,n)=>{const[l,d,g,,p,v,o]=C(i,t,n);return[d,async c=>{try{const u=await l.setItems(c);g({...d,...u})}catch(u){v(u)}},p,o]};function R({style:i,children:t}){return e.jsx("div",{className:"vaultrice-card",style:i,children:t})}R.__docgenInfo={description:`A styled card container for Vaultrice UI.

@param props - CardProps
@returns A React div element styled as a card.`,methods:[],displayName:"Card",props:{style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};function I({percentage:i=0,style:t}){const[n,l]=f.useState(0);return f.useEffect(()=>{setTimeout(()=>{l(i)},1300)},[i]),e.jsx("div",{className:"vaultrice-meter-container",style:t,children:e.jsxs("div",{className:`vaultrice-meter-control ${n>100?"vaultrice-meter-control-error":n>90?"vaultrice-meter-control-warning":""}`,children:[e.jsx("div",{className:"vaultrice-meter-track",style:{width:n<100?"100%":`${100/(n/100)}%`}}),e.jsx("div",{className:"vaultrice-meter-state",style:{width:`${n}%`,borderRadius:n>=100?"14px":"14px 0 0 14px",opacity:n===0?0:1}})]})})}I.__docgenInfo={description:`A visual meter bar for displaying percentage values.
Animates to the given percentage after mount/update.

@param props - MeterProps
@returns A React element representing the meter bar.`,methods:[],displayName:"Meter",props:{percentage:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0",computed:!1}},style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""}}};function q({onClick:i,disabled:t,style:n,children:l}){return e.jsx("button",{className:"vaultrice-button",style:n,type:"button",disabled:t,onClick:i,children:l})}q.__docgenInfo={description:`A styled button component for Vaultrice UI.

@param props - ButtonProps
@returns A React button element.`,methods:[],displayName:"Button",props:{style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:""},onClick:{required:!1,tsType:{name:"ReactMouseEventHandler",raw:"React.MouseEventHandler<HTMLButtonElement>",elements:[{name:"HTMLButtonElement"}]},description:""}}};function $(i,t,n,l,d,g){const[p,v]=f.useState(),[o,c]=f.useState(!1),[u,r]=f.useState(!1),[a,s]=f.useState(!1);n||=t;const m=l?l.class||"_undefined_":d?.class||"_undefined_",h=l?l.ttl||3600*1e3:d?.ttl||3600*1e3,w=`${i}-user-${t}-voted`,x=`vaultrice-${i}-user-${n}-${m}-voted`,T=`${i}-user-${t}`,y=i,j=t?V({...l,id:T},g):void 0;return f.useEffect(()=>{const S=async()=>{if(c(!1),t){const b=await j?.getItem(w);r(!!b)}else{let b=window.localStorage.getItem(x);b&&parseInt(b)+h*2<Date.now()&&(window.localStorage.removeItem(x),b=null),r(!!b)}c(!0)};try{S()}catch(b){v(b)}},[w,j,t,n,x,h]),[o,a,u,async S=>{try{if(u)return;s(!0),await V({...d,id:y},g).incrementItem(`${y}-choices-${S}`),t?await j?.setItem(w,Date.now()):window.localStorage.setItem(x,Date.now().toString()),s(!1),r(!0)}catch(b){v(b)}},p]}const P=({id:i,choices:t=[],choicesInstanceOptions:n,credentials:l,bind:d=!0,showPercentage:g=!1,showTotalVotes:p=!0})=>{const[v]=f.useState(t.map(r=>`${i}-choices-${r.id}`)),[o,,,c]=_(i,v,{credentials:l,instanceOptions:n,bind:d});if(!c&&!o)return e.jsxs("div",{className:"vaultrice-voting-result vaultrice-voting-expired",children:[e.jsxs("div",{className:"vaultrice-voting--result-label",children:[e.jsx("span",{className:"vaultrice-voting-expired-icon","aria-label":"Voting closed",role:"img",children:"ðŸ”’"}),e.jsx("label",{className:"vaultrice-voting-expired-label",children:"Voting closed"}),e.jsx("span",{className:"vaultrice-voting-result-label-tag",children:"Expired"})]}),e.jsx("p",{className:"vaultrice-voting-expired-text",children:"This voting has expired and is no longer accepting responses."})]});if(c)return"loading...";if(!o)return null;const u=Object.values(o).reduce((r,a)=>a?.value?r+a.value:r,0);return e.jsxs("div",{className:"vaultrice-voting-results",children:[t.map(r=>{const a=o[`${i}-choices-${r.id}`],s=a?.value?a.value/u*100:0;return e.jsxs("div",{className:"vaultrice-voting-result",children:[e.jsxs("div",{className:"vaultrice-voting--result-label",children:[e.jsx("label",{children:r.label}),e.jsx("span",{className:"vaultrice-voting-result-label-tag",children:g?`${s.toFixed(1)}%`:a?.value||0})]}),e.jsx(I,{percentage:s})]},r.id)}),p&&e.jsxs("div",{style:{marginTop:12,textAlign:"right",color:"#666",fontSize:13},children:["Total votes: ",e.jsx("b",{children:u})]})]})},E=({id:i,title:t,description:n,voteLabel:l="vote",choices:d=[],choicesInstanceOptions:g,userId:p,userIdForLocalStorage:v,userInstanceOptions:o,credentials:c,bind:u=!0,showPercentage:r=!1,showTotalVotes:a=!0})=>{const[s,m]=f.useState(d?.[0]?.id),[h,w,x,T]=$(i,p,v,o,g,c);return h?e.jsxs(R,{children:[!!t&&e.jsx("h3",{className:"vaultrice-voting-title",children:t}),!!n&&e.jsx("p",{className:"vaultrice-voting-description",children:n}),!!x&&e.jsx(P,{id:i,choices:d,choicesInstanceOptions:g,credentials:c,bind:u,showPercentage:r,showTotalVotes:a}),!x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"vaultrice-voting-choices",children:d.map(y=>e.jsxs("div",{className:"vaultrice-voting-choice",onClick:j=>{j.target.tagName!=="INPUT"&&m(y.id)},style:{cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:y.id,value:y.id,checked:y.id===s,onChange:()=>{m(y.id)},style:{cursor:"pointer"}}),e.jsx("label",{htmlFor:y.id,style:{cursor:"pointer"},children:y.label})]},y.id))}),e.jsx(q,{onClick:()=>{T(s)},disabled:w,children:w?"...voting":l})]}),e.jsxs("div",{className:"vaultrice-voting-disclaimer",children:["Powered by ",e.jsx("a",{href:"https://www.vaultrice.com",target:"_blank",rel:"noreferrer",children:"vaultrice.com"})," - get yours ",e.jsx("a",{href:"https://www.vaultrice.app/register",target:"_bland",children:"for free!"})]})]}):null};E.__docgenInfo={description:`Voting component for Vaultrice UI.

Renders a voting form with selectable choices, handles voting logic,
and displays results after voting.

@param props - VotingProps
@returns A React element for voting.`,methods:[],displayName:"Voting",props:{id:{required:!0,tsType:{name:"string"},description:"Unique identifier for the voting instance."},title:{required:!1,tsType:{name:"union",raw:"string | ReactNode",elements:[{name:"string"},{name:"ReactNode"}]},description:"Optional headline for the voting."},description:{required:!1,tsType:{name:"union",raw:"string | ReactNode",elements:[{name:"string"},{name:"ReactNode"}]},description:"Optional description for the voting."},voteLabel:{required:!1,tsType:{name:"string"},description:`Optional label for the voting button.
@default 'vote'`,defaultValue:{value:"'vote'",computed:!1}},choices:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  /**
   * Unique identifier for the choice.
   */
  id: string,
  /**
   * Display label for the choice.
   */
  label: string | ReactNode
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0},description:"Unique identifier for the choice."},{key:"label",value:{name:"union",raw:"string | ReactNode",elements:[{name:"string"},{name:"ReactNode"}],required:!0},description:"Display label for the choice."}]}}],raw:"Array<ChoiceOption>"},description:"Array of available choices for the voting.",defaultValue:{value:"[]",computed:!1}},choicesInstanceOptions:{required:!1,tsType:{name:"InstanceOptions"},description:"Optional instance options for managing choices storage."},userId:{required:!1,tsType:{name:"string"},description:"Optional user identifier. If provided, voting status is stored in Vaultrice; otherwise, localStorage is used."},userInstanceOptions:{required:!1,tsType:{name:"InstanceOptions"},description:"Optional instance options for managing user storage."},credentials:{required:!1,tsType:{name:"Credentials"},description:"Optional credentials for accessing Vaultrice SDK, if not using vaultrice.init."},bind:{required:!1,tsType:{name:"boolean"},description:`Whether to bind to changes.
@default true`,defaultValue:{value:"true",computed:!1}},userIdForLocalStorage:{required:!1,tsType:{name:"string"},description:`Optional user identifier for localStorage.
If not provided it wull use the passed userId or undefined.
@default 'undefined'`},showPercentage:{required:!1,tsType:{name:"boolean"},description:"Show percentage instead of raw vote count.",defaultValue:{value:"false",computed:!1}},showTotalVotes:{required:!1,tsType:{name:"boolean"},description:`Show total votes below the results.
@default true`,defaultValue:{value:"true",computed:!1}}}};const D={title:"Vaultrice/Voting",component:E,parameters:{layout:"centered"},tags:["autodocs"],argTypes:{credentials:{control:!1}},args:{}},N={args:{id:"voting1",title:"Vote for our latest feature proposal",description:"Every voice counts to get this component like you want it.",choices:[{id:"op1",label:"Create a render prop."},{id:"op2",label:"Have a dark theme."},{id:"op3",label:e.jsxs(e.Fragment,{children:["I'm already ",e.jsx("a",{href:"https://www.vaultrice.com/",target:"_blank",rel:"noreferrer",children:"happy"})," with what ",e.jsx("strong",{children:"I got"}),"."]})}],credentials:{projectId:"253c8eeb-dcdf-4d67-8557-a7a8b92228be",apiKey:"08ee33b7-9e85-47b8-a164-87f0afba70fc",apiSecret:"27b20eee-3171-4727-8280-17ef62556c9f"}}};N.parameters={...N.parameters,docs:{...N.parameters?.docs,source:{originalSource:`{
  args: {
    id: 'voting1',
    title: 'Vote for our latest feature proposal',
    description: 'Every voice counts to get this component like you want it.',
    choices: [{
      id: 'op1',
      label: 'Create a render prop.'
    }, {
      id: 'op2',
      label: 'Have a dark theme.'
    }, {
      id: 'op3',
      label: <>I'm already <a href='https://www.vaultrice.com/' target='_blank' rel='noreferrer'>happy</a> with what <strong>I got</strong>.</>
    }],
    credentials: {
      projectId: import.meta.env.VITE_VAULTRICE_PROJECTID,
      apiKey: import.meta.env.VITE_VAULTRICE_APIKEY,
      apiSecret: import.meta.env.VITE_VAULTRICE_APISECRET
    }
  }
}`,...N.parameters?.docs?.source}}};const K=["Primary"];export{N as Primary,K as __namedExportsOrder,D as default};
