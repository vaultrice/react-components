import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as f}from"./iframe-QT8oHMxz.js";import{e as R}from"./theme-XIYBvMck.js";import{e as _}from"./useNonLocalStorage-DTUqfFwM.js";import"./preload-helper-D9Z9MdNV.js";const E=(r,t,a)=>{const[s,i,m,,h,v,d]=_(r,t,a);return[i,async u=>{try{const o=await s.setItems(u);m({...i,...o})}catch(o){v(o)}},h,d]};function S({style:r,children:t}){return e.jsx("div",{className:"vaultrice-card",style:r,children:t})}S.__docgenInfo={description:`A styled card container for Vaultrice UI.

@param props - CardProps
@returns A React div element styled as a card.`,methods:[],displayName:"Card",props:{style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};function I({percentage:r=0,style:t}){const[a,s]=f.useState(0);return f.useEffect(()=>{setTimeout(()=>{s(r)},1300)},[r]),e.jsx("div",{className:"vaultrice-meter-container",style:t,children:e.jsxs("div",{className:`vaultrice-meter-control ${a>100?"vaultrice-meter-control-error":a>90?"vaultrice-meter-control-warning":""}`,children:[e.jsx("div",{className:"vaultrice-meter-track",style:{width:a<100?"100%":`${100/(a/100)}%`}}),e.jsx("div",{className:"vaultrice-meter-state",style:{width:`${a}%`,borderRadius:a>=100?"14px":"14px 0 0 14px",opacity:a===0?0:1}})]})})}I.__docgenInfo={description:`A visual meter bar for displaying percentage values.
Animates to the given percentage after mount/update.

@param props - MeterProps
@returns A React element representing the meter bar.`,methods:[],displayName:"Meter",props:{percentage:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0",computed:!1}},style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""}}};function q({onClick:r,disabled:t,style:a,children:s}){return e.jsx("button",{className:"vaultrice-button",style:a,type:"button",disabled:t,onClick:r,children:s})}q.__docgenInfo={description:`A styled button component for Vaultrice UI.

@param props - ButtonProps
@returns A React button element.`,methods:[],displayName:"Button",props:{style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:""},onClick:{required:!1,tsType:{name:"ReactMouseEventHandler",raw:"React.MouseEventHandler<HTMLButtonElement>",elements:[{name:"HTMLButtonElement"}]},description:""}}};function P(r,t,a,s,i,m){const[h,v]=f.useState(),[d,u]=f.useState(!1),[o,n]=f.useState(!1),[p,g]=f.useState(!1);a||=t;const x=s?s.class||"_undefined_":i?.class||"_undefined_",j=s?s.ttl||3600*1e3:i?.ttl||3600*1e3,b=`${r}-user-${t}-voted`,y=`vaultrice-${r}-user-${a}-${x}-voted`,T=`${r}-user-${t}`,l=r,w=t?R({...s,id:T},m):void 0;return f.useEffect(()=>{const V=async()=>{if(u(!1),t){const c=await w?.getItem(b);n(!!c)}else{let c=window.localStorage.getItem(y);c&&parseInt(c)+j*2<Date.now()&&(window.localStorage.removeItem(y),c=null),n(!!c)}u(!0)};try{V()}catch(c){v(c)}},[b,w,t,a,y,j]),[d,p,o,async V=>{try{if(o)return;g(!0),await R({...i,id:l},m).incrementItem(`${l}-choices-${V}`),t?await w?.setItem(b,Date.now()):window.localStorage.setItem(y,Date.now().toString()),g(!1),n(!0)}catch(c){v(c)}},h]}const $=({id:r,choices:t=[],choicesInstanceOptions:a,credentials:s,bind:i=!0,showPercentage:m=!1,showTotalVotes:h=!0})=>{const[v]=f.useState(t.map(n=>`${r}-choices-${n.id}`)),[d,,,u]=E(r,v,{credentials:s,instanceOptions:a,bind:i});if(!u&&!d)return e.jsxs("div",{className:"vaultrice-voting-result vaultrice-voting-expired",children:[e.jsxs("div",{className:"vaultrice-voting--result-label",children:[e.jsx("span",{className:"vaultrice-voting-expired-icon","aria-label":"Voting closed",role:"img",children:"ðŸ”’"}),e.jsx("label",{className:"vaultrice-voting-expired-label",children:"Voting closed"}),e.jsx("span",{className:"vaultrice-voting-result-label-tag",children:"Expired"})]}),e.jsx("p",{className:"vaultrice-voting-expired-text",children:"This voting has expired and is no longer accepting responses."})]});if(u)return"loading...";if(!d)return null;const o=Object.values(d).reduce((n,p)=>p?.value?n+p.value:n,0);return e.jsxs("div",{className:"vaultrice-voting-results",children:[t.map(n=>{const p=d[`${r}-choices-${n.id}`],g=p?.value?p.value/o*100:0;return e.jsxs("div",{className:"vaultrice-voting-result",children:[e.jsxs("div",{className:"vaultrice-voting--result-label",children:[e.jsx("label",{children:n.label}),e.jsx("span",{className:"vaultrice-voting-result-label-tag",children:m?`${g.toFixed(1)}%`:p?.value||0})]}),e.jsx(I,{percentage:g})]},n.id)}),h&&e.jsxs("div",{style:{marginTop:12,textAlign:"right",color:"#666",fontSize:13},children:["Total votes: ",e.jsx("b",{children:o})]})]})},C=({id:r,title:t,description:a,voteLabel:s="vote",choices:i=[],choicesInstanceOptions:m,userId:h,userIdForLocalStorage:v,userInstanceOptions:d,credentials:u,bind:o=!0,showPercentage:n=!1,showTotalVotes:p=!0})=>{const[g,x]=f.useState(i?.[0]?.id),[j,b,y,T]=P(r,h,v,d,m,u);return j?e.jsxs(S,{children:[!!t&&e.jsx("h3",{className:"vaultrice-voting-title",children:t}),!!a&&e.jsx("p",{className:"vaultrice-voting-description",children:a}),!!y&&e.jsx($,{id:r,choices:i,choicesInstanceOptions:m,credentials:u,bind:o,showPercentage:n,showTotalVotes:p}),!y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"vaultrice-voting-choices",children:i.map(l=>e.jsxs("div",{className:"vaultrice-voting-choice",onClick:w=>{w.target.tagName!=="INPUT"&&x(l.id)},style:{cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:l.id,value:l.id,checked:l.id===g,onChange:()=>{x(l.id)},style:{cursor:"pointer"}}),e.jsx("label",{htmlFor:l.id,style:{cursor:"pointer"},children:l.label})]},l.id))}),e.jsx(q,{onClick:()=>{T(g)},disabled:b,children:b?"...voting":s})]}),e.jsxs("div",{className:"vaultrice-voting-disclaimer",children:["Powered by ",e.jsx("a",{href:"https://www.vaultrice.com",target:"_blank",rel:"noreferrer",children:"vaultrice.com"})," - get yours ",e.jsx("a",{href:"https://www.vaultrice.app/register",target:"_bland",children:"for free!"})]})]}):null};C.__docgenInfo={description:`Voting component for Vaultrice UI.

Renders a voting form with selectable choices, handles voting logic,
and displays results after voting.

@param props - VotingProps
@returns A React element for voting.`,methods:[],displayName:"Voting",props:{id:{required:!0,tsType:{name:"string"},description:"Unique identifier for the voting instance."},title:{required:!1,tsType:{name:"union",raw:"string | ReactNode",elements:[{name:"string"},{name:"ReactNode"}]},description:"Optional headline for the voting."},description:{required:!1,tsType:{name:"union",raw:"string | ReactNode",elements:[{name:"string"},{name:"ReactNode"}]},description:"Optional description for the voting."},voteLabel:{required:!1,tsType:{name:"string"},description:`Optional label for the voting button.
@default 'vote'`,defaultValue:{value:"'vote'",computed:!1}},choices:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  /**
   * Unique identifier for the choice.
   */
  id: string,
  /**
   * Display label for the choice.
   */
  label: string | ReactNode
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0},description:"Unique identifier for the choice."},{key:"label",value:{name:"union",raw:"string | ReactNode",elements:[{name:"string"},{name:"ReactNode"}],required:!0},description:"Display label for the choice."}]}}],raw:"Array<ChoiceOption>"},description:"Array of available choices for the voting.",defaultValue:{value:"[]",computed:!1}},choicesInstanceOptions:{required:!1,tsType:{name:"InstanceOptions"},description:"Optional instance options for managing choices storage."},userId:{required:!1,tsType:{name:"string"},description:"Optional user identifier. If provided, voting status is stored in Vaultrice; otherwise, localStorage is used."},userInstanceOptions:{required:!1,tsType:{name:"InstanceOptions"},description:"Optional instance options for managing user storage."},credentials:{required:!1,tsType:{name:"Credentials"},description:"Optional credentials for accessing Vaultrice SDK, if not using vaultrice.init."},bind:{required:!1,tsType:{name:"boolean"},description:`Whether to bind to changes.
@default true`,defaultValue:{value:"true",computed:!1}},userIdForLocalStorage:{required:!1,tsType:{name:"string"},description:`Optional user identifier for localStorage.
If not provided it wull use the passed userId or undefined.
@default 'undefined'`},showPercentage:{required:!1,tsType:{name:"boolean"},description:"Show percentage instead of raw vote count.",defaultValue:{value:"false",computed:!1}},showTotalVotes:{required:!1,tsType:{name:"boolean"},description:`Show total votes below the results.
@default true`,defaultValue:{value:"true",computed:!1}}}};const K={title:"Vaultrice/Voting",component:C,parameters:{layout:"centered"},tags:["autodocs"],argTypes:{credentials:{control:!1}},args:{}},N={args:{id:"voting1",title:"Vote for our latest feature proposal",description:"Every voice counts to get this component like you want it.",choices:[{id:"op1",label:"Create a render prop."},{id:"op2",label:"Have a dark theme."},{id:"op3",label:e.jsxs(e.Fragment,{children:["I'm already ",e.jsx("a",{href:"https://www.vaultrice.com/",target:"_blank",rel:"noreferrer",children:"happy"})," with what ",e.jsx("strong",{children:"I got"}),"."]})}],credentials:{projectId:"253c8eeb-dcdf-4d67-8557-a7a8b92228be",apiKey:"08ee33b7-9e85-47b8-a164-87f0afba70fc",apiSecret:"27b20eee-3171-4727-8280-17ef62556c9f"}}};N.parameters={...N.parameters,docs:{...N.parameters?.docs,source:{originalSource:`{
  args: {
    id: 'voting1',
    title: 'Vote for our latest feature proposal',
    description: 'Every voice counts to get this component like you want it.',
    choices: [{
      id: 'op1',
      label: 'Create a render prop.'
    }, {
      id: 'op2',
      label: 'Have a dark theme.'
    }, {
      id: 'op3',
      label: <>I'm already <a href='https://www.vaultrice.com/' target='_blank' rel='noreferrer'>happy</a> with what <strong>I got</strong>.</>
    }],
    credentials: {
      projectId: import.meta.env.VITE_VAULTRICE_PROJECTID,
      apiKey: import.meta.env.VITE_VAULTRICE_APIKEY,
      apiSecret: import.meta.env.VITE_VAULTRICE_APISECRET
    }
  }
}`,...N.parameters?.docs?.source}}};const M=["Primary"];export{N as Primary,M as __namedExportsOrder,K as default};
