import{j as a}from"./jsx-runtime-D_zvdyIk.js";import{r as s}from"./iframe-CUKlEioi.js";import"./theme-ELSemj-T.js";import{o as K,d as J}from"./Presence-DuWhkiWR.js";const L=(n,t=!0)=>{const r=new Date(n),l=new Date,o=r.toDateString()===l.toDateString();return o&&t?r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):o?"Today":r.toLocaleDateString()},_=(n,t)=>{if(!t)return!1;const r=n.timestamp-t.timestamp,l=300*1e3;return n.user===t.user&&r<l},H=(n,t,r,l,o,d=!1,g)=>{const h=t&&o?o:{name:n.user,avatarUrl:n.avatarUrl},f=t?"(You)":n.user,x=g||J;return a.jsxs("div",{className:`vaultrice-chat-message ${t?"vaultrice-chat-message-own":""} ${d?"vaultrice-chat-message-grouped":""}`,children:[r&&!d&&a.jsx("div",{className:"vaultrice-chat-avatar",children:x(h,t)}),r&&d&&a.jsx("div",{className:"vaultrice-chat-avatar vaultrice-chat-avatar-spacer"}),a.jsxs("div",{className:"vaultrice-chat-message-content",children:[!d&&a.jsx("div",{className:"vaultrice-chat-message-user",children:f}),a.jsx("div",{className:"vaultrice-chat-message-text",children:n.message}),l&&a.jsx("div",{className:"vaultrice-chat-message-timestamp",children:L(n.timestamp)})]})]})},Y=({users:n})=>{if(n.length===0)return null;const t=n.length===1?`${n[0]} is typing...`:n.length===2?`${n[0]} and ${n[1]} are typing...`:`${n.slice(0,-1).join(", ")} and ${n[n.length-1]} are typing...`;return a.jsxs("div",{className:"vaultrice-chat-typing",children:[a.jsxs("div",{className:"vaultrice-chat-typing-dots",children:[a.jsx("span",{}),a.jsx("span",{}),a.jsx("span",{})]}),a.jsx("span",{className:"vaultrice-chat-typing-text",children:t})]})},z=({id:n,user:t,onMessage:r,onSendReady:l,placeholder:o="Type a message...",maxHeight:d="400px",showTimestamps:g=!0,showUserAvatars:h=!0,autoScroll:f=!0,credentials:x,instanceOptions:I,messageFilter:j,renderMessage:S,renderAvatar:M,disabled:y=!1})=>{const[v,U]=s.useState([]),[m,R]=s.useState(""),[C,T]=s.useState([]),N=s.useRef(null),k=s.useRef(null),w=s.useRef(l),b=s.useRef(null),q=s.useRef(null),$=s.useCallback(e=>{if(e.type==="typing"&&e.user!==t.name){T(u=>[...u.filter(p=>p!==e.user),e.user]),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{T(u=>u.filter(c=>c!==e.user))},3e3);return}if(!(j&&!j(e))){if(e.type==="chat"&&e.user&&e.message){T(c=>c.filter(p=>p!==e.user));const u={id:`${e.timestamp||Date.now()}-${Math.random()}`,user:e.user,message:e.message,timestamp:e.timestamp||Date.now(),userId:e.userId,avatarUrl:e.avatarUrl,type:e.messageType||"message"};U(c=>[...c,u])}r&&r(e)}},[j,r,t.name]),[,i]=K(n,$,{credentials:x,instanceOptions:I});s.useEffect(()=>{q.current=i},[i]),s.useEffect(()=>{w.current=l},[l]),s.useEffect(()=>{i&&w.current&&w.current(i)},[i]),s.useEffect(()=>{f&&N.current&&N.current.scrollIntoView({behavior:"smooth"})},[v,f]);const D=s.useCallback(()=>{if(m.trim()&&i&&!y){const e={type:"chat",user:t.name,message:m.trim(),timestamp:Date.now(),userId:t.id,avatarUrl:t.avatarUrl||void 0};i(e),R("")}},[m,i,y,t]),E=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),D())},O=e=>{R(e.target.value),q.current&&q.current({type:"typing",user:t.name,userId:t.id,timestamp:Date.now()})},V=S||((e,u,c)=>H(e,u,h,g,t,c,M));return a.jsxs("div",{className:"vaultrice-chat",children:[a.jsxs("div",{className:"vaultrice-chat-messages",style:{maxHeight:d},ref:k,children:[v.length===0?a.jsxs("div",{className:"vaultrice-chat-empty",children:[a.jsx("div",{className:"vaultrice-chat-empty-text",children:"No messages yet"}),a.jsx("div",{className:"vaultrice-chat-empty-subtext",children:"Start the conversation!"})]}):v.map((e,u)=>{const c=e.user===t.name||e.userId===t.id,p=u>0?v[u-1]:null,A=_(e,p);return a.jsx("div",{children:V(e,c,A)},e.id)}),C.length>0&&a.jsx(Y,{users:C}),a.jsx("div",{ref:N})]}),a.jsxs("div",{className:"vaultrice-chat-input-container",children:[a.jsx("input",{type:"text",className:"vaultrice-chat-input",value:m,onChange:O,onKeyDown:E,placeholder:o,disabled:y||!i}),a.jsx("button",{className:"vaultrice-chat-send-button",onClick:D,disabled:y||!m.trim()||!i,children:"Send"})]})]})};z.__docgenInfo={description:"",methods:[],displayName:"Chat",props:{id:{required:!0,tsType:{name:"string"},description:""},user:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  name: string
  avatarUrl?: string
  id?: string
  [key: string]: any
}`,signature:{properties:[{key:"name",value:{name:"string",required:!0}},{key:"avatarUrl",value:{name:"string",required:!1}},{key:"id",value:{name:"string",required:!1}},{key:{name:"string"},value:{name:"any",required:!0}}]}},description:""},onMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"(msg: JSONObj) => void",signature:{arguments:[{type:{name:"JSONObj"},name:"msg"}],return:{name:"void"}}},description:""},onSendReady:{required:!1,tsType:{name:"signature",type:"function",raw:"(send: (msg: any) => void) => void",signature:{arguments:[{type:{name:"signature",type:"function",raw:"(msg: any) => void",signature:{arguments:[{type:{name:"any"},name:"msg"}],return:{name:"void"}}},name:"send"}],return:{name:"void"}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'Type a message...'",computed:!1}},maxHeight:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'400px'",computed:!1}},showTimestamps:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},showUserAvatars:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},autoScroll:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},credentials:{required:!1,tsType:{name:"Credentials"},description:""},instanceOptions:{required:!1,tsType:{name:"InstanceOptions"},description:""},messageFilter:{required:!1,tsType:{name:"signature",type:"function",raw:"(msg: any) => boolean",signature:{arguments:[{type:{name:"any"},name:"msg"}],return:{name:"boolean"}}},description:""},renderMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"(msg: ChatMessage, isOwnMessage: boolean) => ReactNode",signature:{arguments:[{type:{name:"ChatMessage"},name:"msg"},{type:{name:"boolean"},name:"isOwnMessage"}],return:{name:"ReactNode"}}},description:""},renderAvatar:{required:!1,tsType:{name:"signature",type:"function",raw:"(user: any, isOwnConnection?: boolean) => ReactNode",signature:{arguments:[{type:{name:"any"},name:"user"},{type:{name:"boolean"},name:"isOwnConnection"}],return:{name:"ReactNode"}}},description:"Custom avatar renderer function for chat messages."},disabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};export{z as C};
